DROP TABLE REVIEW_LIKE;

CREATE TABLE REVIEW_LIKE(
MOVIE_ID NUMBER REFERENCES MOVIE (MOVIE_ID),
USER_ID VARCHAR2(40) REFERENCES USERS (USER_ID),
LIKE_ID VARCHAR2(40) REFERENCES USERS (USER_ID)
);

/*테이블 구조에 on delete cascade 붙여야함*/

INSERT INTO REVIEW_LIKE VALUES(330457,'duswl13','sonyeonsoo');
INSERT INTO REVIEW_LIKE VALUES(330457,'duswl13','jiyeon');

INSERT INTO REVIEW_LIKE VALUES(429617,'duswl13','jiyeon');
INSERT INTO REVIEW_LIKE VALUES(429617,'sonyeonsoo','sonyeonsoo');
INSERT INTO REVIEW_LIKE VALUES(429617,'duswl13','duswl13');

INSERT INTO REVIEW_LIKE VALUES(330457,'sonyeonsoo','duswl13');
INSERT INTO REVIEW_LIKE VALUES(330457,'sonyeonsoo','sonyeonsoo');
INSERT INTO REVIEW_LIKE VALUES(330457,'sonyeonsoo','jiyeon');

INSERT INTO REVIEW_LIKE VALUES(330457,'jiyeon','jiyeon');


/*해당 영화 리뷰의 좋아요 순 상위 3개 제발 누가 쉽게좀 고쳐ㅜ저ㅜㅜㅜ*/
SELECT ROWNUM, USER_ID, MOVIE_ID, count FROM
(SELECT USER_ID,MOVIE_ID, (SELECT COUNT(*) FROM
				REVIEW_LIKE 
				WHERE REVIEW_LIKE.USER_ID = REVIEW.USER_ID AND 
				REVIEW_LIKE.MOVIE_ID = REVIEW.MOVIE_ID) count
FROM REVIEW WHERE MOVIE_ID= 330457 ORDER BY count DESC) where rownum <= 3;



/*
SELECT * FROM 
				(SELECT (SELECT COUNT(*) FROM 
								REVIEW_LIKE 
								WHERE REVIEW_LIKE.USER_ID = REVIEW.USER_ID AND 
								REVIEW_LIKE.MOVIE_ID = REVIEW.MOVIE_ID) count, USER_ID,MOVIE_ID,REVIEW_TITLE,REVIEW_CONTENT,REVIEW_DATE
				FROM REVIEW WHERE MOVIE_ID= 330457 ORDER BY count DESC) where rownum <= 3;

			*/	
				
			

/*해당 영화에 대한 리뷰 좋아요, 표정점수, 별점점수  전부 다 나오게*/
SELECT * FROM 
				(SELECT 
				
						(SELECT COUNT(*) FROM 
								REVIEW_LIKE 
								WHERE REVIEW_LIKE.USER_ID = REVIEW.USER_ID AND 
								REVIEW_LIKE.MOVIE_ID = REVIEW.MOVIE_ID) count, /*좋아요*/
				
						(SELECT RATING_FACE_value FROM 
								RATING_FACE 
								WHERE RATING_FACE.USER_ID = REVIEW.USER_ID AND 
								RATING_FACE.MOVIE_ID = REVIEW.MOVIE_ID) face, /*표정점수*/
						(SELECT RATING_STAR_value FROM 
								RATING_STAR 
								WHERE RATING_STAR.USER_ID = REVIEW.USER_ID AND 
								RATING_STAR.MOVIE_ID = REVIEW.MOVIE_ID) star, /*별점점수*/
						USER_ID,MOVIE_ID,REVIEW_TITLE,REVIEW_CONTENT,REVIEW_DATE
						
				FROM REVIEW WHERE MOVIE_ID= 330457 ORDER BY count DESC) where rownum <= 3;

